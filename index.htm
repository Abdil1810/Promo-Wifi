<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Inventori & Sales</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { margin-top: 30px; }
    input, select, button { margin: 5px; padding: 8px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #444; padding: 6px; text-align: center; }
    th { background: #eee; }
    .print-btn { margin-top: 20px; padding: 10px 15px; }
  </style>
</head>
<body>

  <h1>Inventori & Sales System</h1>

  <!-- Form Input Barang -->
  <h2>Tambah Barang</h2>
  <input type="text" id="namaBarang" placeholder="Nama Barang">
  <input type="number" id="stokBarang" placeholder="Stok (pcs)">
  <button onclick="tambahBarang()">Tambah</button>

  <table id="tabelBarang">
    <thead>
      <tr>
        <th>Nama Barang</th>
        <th>Stok</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Form Input Penjualan -->
  <h2>Tambah Penjualan</h2>
  <input type="text" id="namaToko" placeholder="Nama Toko">
  <input type="text" id="koordinat" placeholder="Koordinat Toko (lat,lon)">
  <select id="barangSelect"></select>
  <input type="number" id="jumlahJual" placeholder="Jumlah (pcs)">
  <input type="date" id="tglJual">
  <button onclick="tambahPenjualan()">Tambah Penjualan</button>

  <table id="tabelSales">
    <thead>
      <tr>
        <th>Tanggal</th>
        <th>Nama Toko</th>
        <th>Koordinat</th>
        <th>Barang</th>
        <th>Jumlah</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Tombol Cetak -->
  <button class="print-btn" onclick="window.print()">Cetak Laporan</button>

  <script>
    let barang = JSON.parse(localStorage.getItem("barang")) || [];
    let sales = JSON.parse(localStorage.getItem("sales")) || [];

    function simpanData() {
      localStorage.setItem("barang", JSON.stringify(barang));
      localStorage.setItem("sales", JSON.stringify(sales));
    }

    function renderBarang() {
      let tbody = document.querySelector("#tabelBarang tbody");
      let select = document.querySelector("#barangSelect");
      tbody.innerHTML = "";
      select.innerHTML = "";
      barang.forEach((b, i) => {
        tbody.innerHTML += `<tr><td>${b.nama}</td><td>${b.stok}</td></tr>`;
        select.innerHTML += `<option value="${i}">${b.nama}</option>`;
      });
    }

    function renderSales() {
      let tbody = document.querySelector("#tabelSales tbody");
      tbody.innerHTML = "";
      sales.forEach(s => {
        tbody.innerHTML += `
          <tr>
            <td>${s.tanggal}</td>
            <td>${s.toko}</td>
            <td>${s.koordinat}</td>
            <td>${s.barang}</td>
            <td>${s.jumlah}</td>
          </tr>`;
      });
    }

    function tambahBarang() {
      let nama = document.getElementById("namaBarang").value;
      let stok = parseInt(document.getElementById("stokBarang").value);
      if (!nama || !stok) return alert("Isi nama dan stok barang!");
      barang.push({ nama, stok });
      simpanData();
      renderBarang();
    }

    function tambahPenjualan() {
      let toko = document.getElementById("namaToko").value;
      let koordinat = document.getElementById("koordinat").value;
      let barangIndex = document.getElementById("barangSelect").value;
      let jumlah = parseInt(document.getElementById("jumlahJual").value);
      let tanggal = document.getElementById("tglJual").value;

      if (!toko || !koordinat || jumlah <= 0 || !tanggal) {
        return alert("Lengkapi semua data!");
      }

      let namaBarang = barang[barangIndex].nama;

      // Kurangi stok
      if (barang[barangIndex].stok < jumlah) {
        return alert("Stok tidak cukup!");
      }
      barang[barangIndex].stok -= jumlah;

      sales.push({ tanggal, toko, koordinat, barang: namaBarang, jumlah });
      simpanData();
      renderBarang();
      renderSales();
    }

    // Render awal
    renderBarang();
    renderSales();
  </script>

</body>
</html>
